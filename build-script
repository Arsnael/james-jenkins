def branch = 'JWC-193'
def repoURL = 'https://ci.open-paas.org/stash/scm/jwc/james-parent.git'
def dockerHostURL = 'tcp://62.210.100.33:2376'
def tlsParameters = '--tls=true --tlscacert=/keys/ca.pem --tlskey=/keys/key.pem --tlscert=/keys/cert.pem'
def dockerParameters = "-H ${dockerHostURL} ${tlsParameters}"
def projectName = 'james-parent'

job('DSL-Build-James') {
    scm {
        git {
            remote {
                url(repoURL)
            }
            clean()
            localBranch(branch)
            relativeTargetDir(projectName)
        }
    }
    triggers {
        scm('*/15 * * * *')
    }
    steps {
        shell("cd ${projectName} && docker ${dockerParameters} build -t james/parent .")
        shell("cd ${projectName} && docker ${dockerParameters} run --volumes-from maven-cache -v /destination -t james/parent -u ${repoURL} ${branch}")
    }
}
